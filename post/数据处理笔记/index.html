  <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> 数据处理笔记 &middot; Miao&amp;Blog </title>
    
    <link rel="stylesheet" type="text/css" href="https://charliemini.github.io/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="https://charliemini.github.io/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://charliemini.github.io/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="https://charliemini.github.io/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Miao&amp;Blog" />
    
    <script src="https://charliemini.github.io/js/jquery.min.js"></script>
    <script src="https://charliemini.github.io/js/main.min.js">
    </script>
</head>

  <body>
    <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="https://charliemini.github.io/" title="link to homepage for Miao&amp;Blog"> <img src="https://charliemini.github.io/img/logo-1.jpg" width="80" alt="Miao&amp;Blog logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="https://charliemini.github.io/"  title="link to homepage for Miao&amp;Blog">Miao&amp;Blog</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  欢迎来到我的博客，下方有我的联系方式  </p>
                <hr class="panel-cover__divider panel-cover__divider--secondary" />
                <div class="navigation-wrapper">
                    <nav class="cover-navigation cover-navigation--primary">
                        <ul class="navigation">
                            <li class="navigation__item"><a href="https://charliemini.github.io#blog" title="link to Miao&amp;Blog blog" class="blog-button">Blog</a> </li></br>
                            
                            
                       </ul>
                    </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/wallflo61460582" title="@wallflo61460582 on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/charliemini" title="charliemini on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>   
        
        <li class="navigation__item">
            <a href="mailto:2314259324@qq.com" title="Email 2314259324@qq.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="https://charliemini.github.io/" title="link to homepage for Miao&amp;Blog"> <img src="https://charliemini.github.io/img/logo-1.jpg" width="80" alt="Miao&amp;Blog logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="https://charliemini.github.io/"  title="link to homepage for Miao&amp;Blog">Miao&amp;Blog</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  欢迎来到我的博客，下方有我的联系方式  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                                <li class="navigation__item"><a href="https://charliemini.github.io/#blog" title="link to Miao&amp;Blog blog" class="blog-button">Blog</a> </li></br>
                                
                                
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/wallflo61460582" title="@wallflo61460582 on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/charliemini" title="charliemini on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>   
        
        <li class="navigation__item">
            <a href="mailto:2314259324@qq.com" title="Email 2314259324@qq.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <div class="post">
          <h1>数据处理笔记</h1>
          <span class="post-date">Fri, Jul 12, 2019</span>
          <h1 id="数据处理">数据处理</h1>

<p><strong><em>数据分析最主要的是数据，数据是分析的基石和导向，一定要保证数据的可靠性和所要得到的结果之间的关联性</em></strong></p>

<h2 id="numpy">numpy</h2>

<p><code>ny.reshape(-1, 1)</code> 改变numpy纬度，-1表示不确定行数，根据列数匹配。</p>

<p>numpy.corrcoef(x, y)</p>

<p>返回皮尔森相关系数，类似df.corr() 默认参数的方法。</p>

<p><code>df.merge(data, on= columns)</code> 合并</p>

<p><code>df.groupby()</code> 分组</p>

<p><code>np.linspace(start, stop, num)</code> 返回一个start值为首，end值为尾，共num个值的等差队列</p>

<h2 id="sklearn">sklearn</h2>

<h3 id="预处理">预处理</h3>

<p><code>sklearn.preprocessing.LabelEncoder</code> 对不连续的数字或字符串数据进行编号</p>

<h4 id="缺失值处理">缺失值处理</h4>

<pre><code class="language-python3">class sklearn.impute.SimpleImputer(missing_values=nan, strategy=’mean’, fill_value=None, verbose=0, copy=True, add_indicator=False)[source]


my_imputer = SimpleImputer()
imputed_X_train = pd.DataFrame(my_imputer.fit_transform(X_train))
imputed_X_valid = pd.DataFrame(my_imputer.transform(X_valid))

# Imputation removed column names; put them back
imputed_X_train.columns = X_train.columns
imputed_X_valid.columns = X_valid.columns
</code></pre>

<p>填补缺失值。</p>

<h4 id="处理分类变量">处理分类变量</h4>

<ul>
<li>编码转换，将分类变量根据某一趋势转换成数值性变量</li>
</ul>

<pre><code class="language-python3">  from sklearn.preprocessing import LabelEncoder
  
  # Make copy to avoid changing original data 
  label_X_train = X_train.copy()
  label_X_valid = X_valid.copy()
  
  # Apply label encoder to each column with categorical data
  label_encoder = LabelEncoder()
  for col in object_cols:
      label_X_train[col] = label_encoder.fit_transform(X_train[col])
      label_X_valid[col] = label_encoder.transform(X_valid[col])
</code></pre>

<ul>
<li>one-hot编码，根据分类变量创建多列，然后用1或0表示是否。</li>
</ul>

<pre><code class="language-python3">  from sklearn.preprocessing import OneHotEncoder
  
  # Apply one-hot encoder to each column with categorical data
  OH_encoder = OneHotEncoder(handle_unknown='ignore', sparse=False)
  OH_cols_train = pd.DataFrame(OH_encoder.fit_transform(X_train[object_cols]))
  OH_cols_valid = pd.DataFrame(OH_encoder.transform(X_valid[object_cols]))
  
  # One-hot encoding removed index; put it back
  OH_cols_train.index = X_train.index
  OH_cols_valid.index = X_valid.index
  
  # Remove categorical columns (will replace with one-hot encoding)
  num_X_train = X_train.drop(object_cols, axis=1)
  num_X_valid = X_valid.drop(object_cols, axis=1)
  
  # Add one-hot encoded columns to numerical features
  OH_X_train = pd.concat([num_X_train, OH_cols_train], axis=1)
  OH_X_valid = pd.concat([num_X_valid, OH_cols_valid], axis=1)
  
</code></pre>

<p>查找字符串特征</p>

<pre><code># get list of categorical variable
x = (df.dtypes == 'objects')
object_cols = x
</code></pre>

<h4 id="标准化">标准化</h4>

<ul>
<li>Z-score 去均值、方差缩放</li>
</ul>

<p>标准化的前提是特征值服从正态分布，标准化后，其转换成标准正态分布。</p>

<p>尽量将数据转化为均值为零，方差为一的数据，形如标准正态分布（高斯分布）。实际中我们会忽略数据的分布情况，仅仅是通过改变均值来集中数据，然后将非连续特征除以他们的标准差：<code>(x-mean)/std</code>。</p>

<p><code>preprocessing.StandardScaler()</code> 和<code>preprocessing.scale()</code>都可以实现此目标，但standardScaler的好处是可以保存训练集中的参数（mean，std），直接使用其对象转换测试集数据。</p>

<pre><code class="language-python3">  scaler = preprocessing.StandardScaler().fit(train_data)
  train_scaled = scaler.transform(train_data)
  
  # 直接用scaler对象转换测试集数据
  test_scaled = scaler.trasform(test_data)
</code></pre>

<ul>
<li>缩放</li>
</ul>

<p><code>(x-min(axis=0))/(max(axis=0)-min(axis=0))</code></p>

<p>将特征属性缩放到一个指定的最大值和最小值（通常是 [0, 1]）之间，可以通过<code>preprocessing.MinMaxScaler</code> 类实现。对于方差非常小的特征属性</p>

<pre><code class="language-python3">  min_max_scaler = preprocessing.MinMaxScaler()
  tarin_x_minmax = min_max_scaler.fit_transform(tarin_x)
</code></pre>

<ul>
<li>正则化

<br /></li>
</ul>

<h4 id="二值化">二值化</h4>

<h4 id="哑编码">哑编码</h4>

<h3 id="交叉验证">交叉验证</h3>

<p>在一个数据集中，势必要分出训练集和测试集，那么一盒中百分比分配就成了一个问题。因为一般来说，训练集越大模型越准确，但是相应的测试集就变小了，测试验证的时候可能不能够准确地验证模型的准确性高低。在这种情况下，可以采用交叉验证的返法，将数据集分为不同的子集，依次便利将一个子集作为测试集，其它子集作为训练集，验证模型的准确性。</p>

<pre><code class="language-python3">from sklearn.model_selection import cross_val_score

# Multiply by -1 since sklearn calculates *negative* MAE
scores = cross_val_score(clf, X, y, cv=5,
                            scoring='neg_mean_absolute_error')

</code></pre>

<ul>
<li>clf指的是使用的算法</li>
<li>cv是使用的交叉验证的生成器或迭代器，决定数据的划分，当cv为整数的时光，使用KFold方法</li>
<li>Scoring 决定了使用的分数计算方法。</li>
</ul>

<h3 id="决策树">决策树</h3>

<p><code>DecisionTreeRegressor</code> 决策树，参数如下</p>

<ol>
<li>max_leaf_nodes: int or None，最大叶子节点数，在特征分成过多的情况下通过定义它可以防止过拟合</li>
</ol>

<p><code>from sklearn.model_selection import train_test_split</code></p>

<p>train_test_split 函数旨在将矩阵随机划分为训练子集和测试子集两部分，并返回划分好的训练集、测试集样本和训练集、测试集标签：<code>x_train, x_test,y_tarin, y_test = train_test_split(train_data, train_target, trandom_state=0, test_size=0.3)</code>    <br>random_state: 随机数编号，在需要重复测试的时候，通过此随机数编号得到一组一样的数据。    <br>train_size/test_size: 训练集/测试集样本占比，如果是整数则表示样本数量。</p>

<h3 id="随机森林">随机森林</h3>

<pre><code class="language-python3">from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_absolute_error

forest_model = RandomForestRegressor(random_state=1)
forest_model.fit(train_X, train_y)
melb_preds = forest_model.predict(val_X)
print(mean_absolute_error(val_y, melb_preds))
</code></pre>

<h3 id="xgboost-极端梯度提升">xgboost — 极端梯度提升</h3>

<p>也是集成学习方法的一种，在大部分回归和分类问题上表现都很好。</p>

<p><a href="https://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.XGBRegressor">XGBRegressor</a></p>

<h3 id="优化调参">优化调参</h3>

<pre><code>from sklearn.gird_search import RondomizedSearchCV,GridSearchCV
</code></pre>

<h2 id="pandas">pandas</h2>

<p><code>df.sort_values(by, axis=0, ascending=True, inplace=Flase, kind='quicksort', na_position='last')</code> <br>axis=0时，by指的是列名；axis=1时，by指的是行名。<br>ascending默认为True，正序排列，也可传入bool的list对应by相同长度的list。<br>inplace默认false，是否使用排序后的数据代替原始数据。<br>kind指的是排序方法：quicksort, merge sort, heapsort.<br>na_position=&lsquo;last&rsquo; / &lsquo;first&rsquo; 指缺失值放在最后还是最前面</p>

<p><code>df.nlargest(*n*, *columns*, *keep='first'* )</code>  <br><strong>n</strong> : int</p>

<blockquote>
<p>Number of items to retrieve</p>
</blockquote>

<p><strong>columns</strong> : list or str</p>

<blockquote>
<p>Column name or names to order by</p>
</blockquote>

<p><strong>keep</strong> : {‘first’, ‘last’, False}, default ‘first’</p>

<blockquote>
<p>Where there are duplicate values: - <code>first</code> : take the first occurrence. - <code>last</code> : take the last occurrence.</p>
</blockquote>

<p><code>df.values()</code>  返回dataframe的numpy表示</p>

<p><code>DataFrame.nunique(*self*, *axis=0*, *dropna=True)</code> 返回列/行不重复元素的个数。</p>

<p><code>pandas.get_dummies(*data*, *prefix=None*, *prefix_sep='_'*, *dummy_na=False*, *columns=None*, *sparse=False*, *drop_first=False*, *dtype=None*)</code> 将分类变量转换为指示变量，将一个分类变量变成多个1，0表示的变量</p>

<h2 id="scipy">scipy</h2>

<h3 id="scipy-stats-包含了多种统计方法">scipy.stats 包含了多种统计方法</h3>

<p><code>norm</code> 正太分布函数，norm.pdf(x) = $exp(-x**<sup>2</sup>&frasl;<sub>2</sub>)/sqrt(2*pi)$</p>
        </div>
        <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e7%ac%94%e8%ae%b0-https%3a%2f%2fcharliemini.github.io%2fpost%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25A4%2584%25E7%2590%2586%25E7%25AC%2594%25E8%25AE%25B0%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcharliemini.github.io%2fpost%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25A4%2584%25E7%2590%2586%25E7%25AC%2594%25E8%25AE%25B0%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=https%3a%2f%2fcharliemini.github.io%2fpost%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25A4%2584%25E7%2590%2586%25E7%25AC%2594%25E8%25AE%25B0%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcharliemini.github.io%2fpost%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25A4%2584%25E7%2590%2586%25E7%25AC%2594%25E8%25AE%25B0%2f&title=%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e7%ac%94%e8%ae%b0" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fcharliemini.github.io%2fpost%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25A4%2584%25E7%2590%2586%25E7%25AC%2594%25E8%25AE%25B0%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fcharliemini.github.io%2fpost%2f%25E6%2595%25B0%25E6%258D%25AE%25E5%25A4%2584%25E7%2590%2586%25E7%25AC%2594%25E8%25AE%25B0%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>
        



      </div>
    </div>

  </body>
  
</html>
